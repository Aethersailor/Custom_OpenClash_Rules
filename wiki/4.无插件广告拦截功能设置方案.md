# ğŸš« æ— æ’ä»¶å¹¿å‘Šæ‹¦æˆªåŠŸèƒ½è®¾ç½®æ–¹æ¡ˆ (å·²åºŸå¼ƒ)

> [!CAUTION]
> **æœ¬æ–¹æ¡ˆå·²åœæ­¢ç»´æŠ¤**
>
> æœ¬é¡µé¢æ‰€æè¿°çš„å¹¿å‘Šæ‹¦æˆªåŠŸèƒ½å·²ä¸å†æ¨èä½¿ç”¨ã€‚è¯¥æ–¹æ¡ˆå¯èƒ½å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ï¼Œä¸”ä¸å†è·å¾—åç»­æ›´æ–°æ”¯æŒã€‚
>
> **æ¨èæ›¿ä»£æ–¹æ¡ˆ**ï¼š
> å»ºè®®å®‰è£… `luci-app-adblock` (æ­é… `luci-i18n-adblock-zh-cn`) æˆ–å®‰è£… `luci-app-adblock-fast` (æ­é… `luci-i18n-adblock-fast-zh-cn`)ã€‚è¿™äº›æ’ä»¶åŒæ ·åŸºäº Dnsmasq å®ç°æ‹¦æˆªï¼Œä½†æä¾›äº†æ›´å®Œå–„çš„ GUI ç®¡ç†ç•Œé¢å’Œæ›´ç¨³å®šçš„è§„åˆ™æ›´æ–°æœºåˆ¶ã€‚æ›´æ¨è fast å› ä¸ºæ›´è½»é‡åŒ–ã€‚

---

## ğŸ“– 1. æ–¹æ¡ˆç®€ä»‹

æœ¬æ–¹æ¡ˆçš„æ ¸å¿ƒåŸç†æ˜¯åˆ©ç”¨ OpenClash çš„ **"å¼€å‘è€…é€‰é¡¹"** åŠŸèƒ½ï¼Œåœ¨æ’ä»¶å¯åŠ¨æ—¶è¿è¡Œè‡ªå®šä¹‰ Shell è„šæœ¬ã€‚è„šæœ¬ä¼šè‡ªåŠ¨æ‹‰å–è¿œç¨‹çš„å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ–‡ä»¶ï¼ˆDnsmasq æ ¼å¼ï¼‰ï¼Œå¹¶å°†å…¶åŠ è½½åˆ°ç³»ç»Ÿçš„ Dnsmasq æœåŠ¡ä¸­ï¼Œä»è€Œå®ç°æ— éœ€å®‰è£…é¢å¤–æ’ä»¶çš„å¹¿å‘Šæ‹¦æˆªä¸éšç§é˜²æŠ¤ã€‚

### âš ï¸ é£é™©æç¤º

1. **ç¨³å®šæ€§é£é™©**ï¼šç”±äºè„šæœ¬ä¾èµ– curl æ‹‰å–è¿œç¨‹æ–‡ä»¶ï¼Œå—ç½‘ç»œç¯å¢ƒå½±å“è¾ƒå¤§ï¼Œå¯èƒ½å¯¼è‡´æ‹‰å–å¤±è´¥æˆ– Dnsmasq å¯åŠ¨å¼‚å¸¸ã€‚
2. **ç»´æŠ¤è´£ä»»**ï¼šè‹¥æ‚¨åšæŒä½¿ç”¨æœ¬æ–¹æ¡ˆï¼Œéœ€å…·å¤‡ä¸€å®šçš„æ’æŸ¥èƒ½åŠ›ï¼ˆå¦‚æŸ¥çœ‹æ—¥å¿—ã€åˆ†æè„šæœ¬æŠ¥é”™ï¼‰ã€‚é¡¹ç›®ç»´æŠ¤è€…ä¸å¯¹ä½¿ç”¨æœ¬æ–¹æ¡ˆå¯¼è‡´çš„ä»»ä½•ç½‘ç»œæ•…éšœè´Ÿè´£ã€‚
3. **æ•ˆæœé¢„æœŸ**ï¼šæœ¬æ–¹æ¡ˆä»…å®ç° DNSå±‚é¢çš„åŸŸåå±è”½ã€‚å¯¹äºè§†é¢‘è´´ç‰‡å¹¿å‘Šã€ç½‘é¡µå†…åµŒè„šæœ¬å¹¿å‘Šï¼Œå»ºè®®é…åˆæµè§ˆå™¨æ‰©å±•ï¼ˆå¦‚ uBlock Originï¼‰ä»¥è·å¾—æœ€ä½³æ•ˆæœã€‚

---

## ğŸ“œ 2. è§„åˆ™æºè¯´æ˜

> æœ¬é¡¹ç›®å¼•ç”¨çš„è§„åˆ™æºä»…åŸºäºç»´æŠ¤è€…çš„ä¸ªäººæµ‹è¯•ä¸åå¥½ï¼Œä¿æŒæŠ€æœ¯ä¸­ç«‹ã€‚

### 2.1. å¹¿å‘Šè¿‡æ»¤è§„åˆ™åº“

| è§„åˆ™åç§° | ç®€ä»‹ | ç‰¹ç‚¹ |
| :--- | :--- | :--- |
| **[anti-AD](https://github.com/privacy-protection-tools/anti-AD)** | ä¸­æ–‡åŒºçŸ¥åçš„å¹¿å‘Šè¿‡æ»¤åˆ—è¡¨ã€‚ | ğŸ¯ **ç²¾å‡†**ï¼šè‡´åŠ›äºé«˜å‘½ä¸­ç‡ä¸ä½è¯¯æ€ç‡ï¼Œå…¼é¡¾éšç§ä¿æŠ¤ã€‚ |
| **[adblockfilters](https://github.com/217heidai/adblockfilters)** | å…¨é¢çš„è§„åˆ™åˆé›†ï¼Œæ¯8å°æ—¶æ›´æ–°ã€‚ | ğŸ“š **å…¨é¢**ï¼šä¸Šæ¸¸åŒ…å«å¤§é‡å¸¸è§è§„åˆ™ï¼Œè‡ªå¸¦å»é‡æœºåˆ¶ã€‚ |
| **[adblockfilters-modified](https://github.com/Aethersailor/adblockfilters-modified)** | æœ¬é¡¹ç›®ç»´æŠ¤è€…å®šåˆ¶çš„å¢å¼ºç‰ˆã€‚ | ğŸ‹ **å·¨é‡**ï¼šé›†æˆ anti-ad, OISD, 1Hosts ç­‰ï¼Œæ¡ç›®è¾¾ 65w+ã€‚**è¯¯æ€ç‡è¾ƒé«˜ï¼Œæ…ç”¨ã€‚** |
| **[ç§‹é£å¹¿å‘Šè§„åˆ™](https://github.com/TG-Twilight/AWAvenue-Ads-Rule)** | ä¼˜ç§€çš„è½»é‡åŒ–è§„åˆ™åˆ—è¡¨ã€‚ | ğŸƒ **è½»é‡**ï¼šä¸“æ³¨äºç§»åŠ¨ç«¯ä¸å®¶ç”¨ç¯å¢ƒï¼Œæµé‡èŠ‚çœæ•ˆæœæ˜¾è‘—ã€‚ |

> [!NOTE]
> **åŒ…å«å…³ç³»è¯´æ˜**ï¼š
> `adblockfilters-modified` âŠ‡ `adblockfilters` âŠ‡ `ç§‹é£å¹¿å‘Šè§„åˆ™`
> `anti-ad` âŠ‡ `ç§‹é£å¹¿å‘Šè§„åˆ™`
>
> è¯·æ ¹æ®è®¾å¤‡æ€§èƒ½å’Œæ‹¦æˆªéœ€æ±‚é€‰æ‹©å…¶ä¸€å³å¯ï¼Œæ— éœ€é‡å¤æ·»åŠ ã€‚

### 2.2. åŠ é€Ÿè§„åˆ™

- **[GitHub520](https://github.com/521xueweihan/GitHub520)**ï¼šé€šè¿‡ Hosts åŠ é€Ÿ GitHub è®¿é—®ï¼Œè§£å†³å›¾ç‰‡åŠ è½½å¤±è´¥ç­‰é—®é¢˜ã€‚

---

## âš™ï¸ 3. éƒ¨ç½²å‰ç½®æ¡ä»¶

> [!IMPORTANT]
> **å…³é”®è®¾ç½®ï¼šå…³é—­ DNS é‡å®šå‘**

åœ¨éƒ¨ç½²å‰ï¼Œè¯·åŠ¡å¿…å‰å¾€ `ç½‘ç»œ` > `DHCP/DNS` é¡µé¢ï¼Œ**å–æ¶ˆå‹¾é€‰** `DNS é‡å®šå‘` åŠŸèƒ½ã€‚

- **åŸå› **ï¼šè‹¥å¼€å¯é‡å®šå‘ï¼ŒDNS è¯·æ±‚å¯èƒ½è¢«åŠ«æŒè€Œè·³è¿‡ Dnsmasqï¼Œå¯¼è‡´å¹¿å‘Šè¿‡æ»¤å¤±æ•ˆã€‚
- **æ³¨æ„**ï¼šå¦‚æœæ˜¯ LEDE æºç å›ºä»¶ï¼Œå¯èƒ½æ— æ­¤é€‰é¡¹ï¼Œå¯å¿½ç•¥ã€‚

![](../doc/openclash/pics/Redirect.png)

---

## ğŸ› ï¸ 4. éƒ¨ç½²æ–¹æ³•

è¯·åœ¨ **ä¸€é”®è„šæœ¬** æˆ– **æ‰‹åŠ¨é…ç½®** ä¸­äºŒé€‰ä¸€ã€‚

### 4.1. æ–¹å¼ä¸€ï¼šä¸€é”®è„šæœ¬ (SSH)

é€‚åˆç†Ÿæ‚‰ç»ˆç«¯æ“ä½œçš„ç”¨æˆ·ã€‚SSH è¿æ¥è·¯ç”±å™¨åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œæ ¹æ®æç¤ºé€‰æ‹©è§„åˆ™å³å¯ã€‚

```bash
curl -sSL https://testingcf.jsdelivr.net/gh/Aethersailor/Custom_OpenClash_Rules@refs/heads/main/shell/edit_custom_firewall_rules.sh -o edit_custom_firewall_rules.sh && chmod +x edit_custom_firewall_rules.sh && ./edit_custom_firewall_rules.sh
```

![](../doc/openclash/pics/one-key.png)

### 4.2. æ–¹å¼äºŒï¼šæ‰‹åŠ¨é…ç½® (Web ç•Œé¢)

é€‚åˆä¸ä¹ æƒ¯ä½¿ç”¨ SSH çš„ç”¨æˆ·ã€‚

1. è¿›å…¥ `OpenClash` > `æ’ä»¶è®¾ç½®` > `å¼€å‘è€…é€‰é¡¹`ã€‚
2. åœ¨è„šæœ¬ç¼–è¾‘æ¡†ä¸­ï¼Œæ‰¾åˆ° `exit 0` è¿™ä¸€è¡Œã€‚
3. å°†ä¸‹æ–¹çš„ä»»ä¸€è„šæœ¬æ–‡æœ¬ï¼Œ**å®Œæ•´ç²˜è´´** åˆ° `exit 0` **ä¹‹å‰**ã€‚

![](../doc/openclash/pics/dev.png)

---

#### ğŸ“‹ è„šæœ¬æ¨¡æ¿é€‰æ‹©

> ç‚¹å‡»ä¸‹æ–¹æ ‡é¢˜å±•å¼€æŸ¥çœ‹å…·ä½“è„šæœ¬ä»£ç ã€‚ä¸€èˆ¬ç”¨æˆ·æ¨èä½¿ç”¨ **é€‰é¡¹ 1** æˆ– **é€‰é¡¹ 2**ã€‚

<details>
<summary><strong>é€‰é¡¹ 1ï¼šanti-AD + GitHub520 (æ¨èï¼Œå¹³è¡¡ä¹‹é€‰)</strong></summary>

```bash
# ==============ä»¥ä¸‹æ˜¯å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬=================
(
    MAX_WAIT_TIME=30
    WAIT_INTERVAL=2
    elapsed_time=0

    if /etc/init.d/openclash status | grep -q "Syntax:"; then
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æ­£åœ¨æ£€æµ‹ OpenClash è¿è¡ŒçŠ¶æ€..."
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] ç­‰å¾… 10 ç§’ä»¥ç¡®ä¿ OpenClash å·²å¯åŠ¨..."
        sleep 10
    else
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æ­£åœ¨æ£€æµ‹ OpenClash è¿è¡ŒçŠ¶æ€..."
        while ! /etc/init.d/openclash status | grep -q "running"; do
            if [ $elapsed_time -ge $MAX_WAIT_TIME ]; then
                LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æœªèƒ½åœ¨ 30 ç§’å†…æ£€æµ‹åˆ° OpenClash è¿è¡ŒçŠ¶æ€ï¼Œè„šæœ¬å·²åœæ­¢è¿è¡Œ..."
                exit 1
            fi
            sleep $WAIT_INTERVAL
            elapsed_time=$((elapsed_time + WAIT_INTERVAL))
        done
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æ£€æµ‹åˆ° OpenClash æ­£åœ¨è¿è¡Œï¼Œ10 ç§’åå¼€å§‹æ‹‰å–è§„åˆ™..."
        sleep 10
    fi

    LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] å¼€å§‹æ£€æµ‹ dnsmasq è§„åˆ™ç›®å½•..."
    UCI_OUTPUT=$(uci show dhcp.@dnsmasq[0] 2>/dev/null)
    
    if echo "$UCI_OUTPUT" | grep -qE 'cfg[0-9a-f]{6}'; then
        HASH_ID=$(echo "$UCI_OUTPUT" | grep -oE 'cfg[0-9a-f]{6}' | head -1) 
        TARGET_DIR="/tmp/dnsmasq.${HASH_ID}.d"
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] å½“å‰ dnsmasq è§„åˆ™ç›®å½•: $TARGET_DIR"
    elif echo "$UCI_OUTPUT" | grep -qE '@dnsmasq\[[0-9]+\]'; then
        TARGET_DIR="/tmp/dnsmasq.d"
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] å½“å‰dnsmasq è§„åˆ™ç›®å½•: $TARGET_DIR"
    else
        TARGET_DIR=$(find /tmp -maxdepth 1 -type d -name "dnsmasq.*.d" | head -n 1)
        if [ -z "$TARGET_DIR" ]; then
            LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] é”™è¯¯ï¼šæœªæ‰¾åˆ°æœ‰æ•ˆçš„ dnsmasq è§„åˆ™ç›®å½•ï¼Œè„šæœ¬å·²åœæ­¢ï¼"
            exit 1
        fi
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æ£€æµ‹å¤±è´¥ï¼Œä½¿ç”¨å·²å­˜åœ¨çš„ dnsmasq è§„åˆ™ç›®å½•: $TARGET_DIR"
    fi
    
    if [ ! -d "$TARGET_DIR" ]; then
        mkdir -p "$TARGET_DIR"
    fi

    LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æ¸…é™¤å·²æœ‰è§„åˆ™â€¦"
    rm -f "$TARGET_DIR"/*ad*.conf 
    sed -i '/# AWAvenue-Ads-Rule Start/,/# AWAvenue-Ads-Rule End/d' /etc/hosts
    sed -i '/# GitHub520 Host Start/,/# GitHub520 Host End/d' /etc/hosts

    LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æ‹‰å–æœ€æ–°çš„ anti-AD å¹¿å‘Šè¿‡æ»¤è§„åˆ™ï¼Œè§„åˆ™ä½“ç§¯è¾ƒå¤§ï¼Œè¯·è€å¿ƒç­‰å€™â€¦"
    curl -sS -L -4 --retry 5 --retry-delay 1 "https://testingcf.jsdelivr.net/gh/privacy-protection-tools/anti-AD@refs/heads/master/adblock-for-dnsmasq.conf" -o "$TARGET_DIR/anti-ad-for-dnsmasq.conf" >/dev/null 2>/tmp/anti-ad-curl.log
    CURL_EXIT=$?

    if [ $CURL_EXIT -eq 0 ]; then
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] anti-AD è§„åˆ™æ‹‰å–æˆåŠŸï¼ä¿å­˜è·¯å¾„ï¼š${TARGET_DIR}/anti-ad-for-dnsmasq.conf"
    else
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] anti-AD è§„åˆ™æ‹‰å–å¤±è´¥ (é”™è¯¯ç :$CURL_EXIT)ï¼ŒæŸ¥çœ‹ /tmp/anti-ad-curl.log è·å–è¯¦ç»†ä¿¡æ¯ã€‚"
        echo "CURL Exit Code: $CURL_EXIT" >> /tmp/anti-ad-curl.log
    fi

    LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æ‹‰å–æœ€æ–°çš„ GitHub520 åŠ é€Ÿè§„åˆ™â€¦"
    curl -sSL -4 --retry 5 --retry-delay 1 "https://raw.hellogithub.com/hosts" >> /etc/hosts 2> /tmp/github520-curl.log
    CURL_EXIT_GH=$?

    if [ $CURL_EXIT_GH -eq 0 ]; then
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] GitHub520 åŠ é€Ÿè§„åˆ™æ‹‰å–æˆåŠŸï¼å·²è¿½åŠ åˆ° /etc/hosts æ–‡ä»¶ä¸­ã€‚"
    else
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] GitHub520 åŠ é€Ÿè§„åˆ™æ‹‰å–å¤±è´¥ (é”™è¯¯ç :$CURL_EXIT_GH)ï¼ŒæŸ¥çœ‹ /tmp/github520-curl.log è·å–è¯¦ç»†ä¿¡æ¯ã€‚"
        echo "CURL Exit Code: $CURL_EXIT_GH" >> /tmp/github520-curl.log
    fi

    sed -i '/^$/d' /etc/hosts
    sed -i '/!/d' /etc/hosts

    LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] é‡æ–°åŠ è½½ dnsmasq æœåŠ¡ä»¥åº”ç”¨è§„åˆ™â€¦"
    /etc/init.d/dnsmasq stop
    /etc/init.d/dnsmasq start
    LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] è„šæœ¬è¿è¡Œå®Œæ¯•ï¼"

) &
# ==============å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬ç»“æŸ==============
```

</details>

<details>
<summary><strong>é€‰é¡¹ 2ï¼šåŸç‰ˆ adblockfilters + GitHub520 (å…¨é¢ä¹‹é€‰)</strong></summary>

```bash
# ==============ä»¥ä¸‹æ˜¯å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬=================
(
    MAX_WAIT_TIME=30
    WAIT_INTERVAL=2
    elapsed_time=0

    if /etc/init.d/openclash status | grep -q "Syntax:"; then
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æ­£åœ¨æ£€æµ‹ OpenClash è¿è¡ŒçŠ¶æ€..."
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] ç­‰å¾… 10 ç§’ä»¥ç¡®ä¿ OpenClash å·²å¯åŠ¨..."
        sleep 10
    else
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æ­£åœ¨æ£€æµ‹ OpenClash è¿è¡ŒçŠ¶æ€..."
        while ! /etc/init.d/openclash status | grep -q "running"; do
            if [ $elapsed_time -ge $MAX_WAIT_TIME ]; then
                LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æœªèƒ½åœ¨ 30 ç§’å†…æ£€æµ‹åˆ° OpenClash è¿è¡ŒçŠ¶æ€ï¼Œè„šæœ¬å·²åœæ­¢è¿è¡Œ..."
                exit 1
            fi
            sleep $WAIT_INTERVAL
            elapsed_time=$((elapsed_time + WAIT_INTERVAL))
        done
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æ£€æµ‹åˆ° OpenClash æ­£åœ¨è¿è¡Œï¼Œ10 ç§’åå¼€å§‹æ‹‰å–è§„åˆ™..."
        sleep 10
    fi

    LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] å¼€å§‹æ£€æµ‹ dnsmasq è§„åˆ™ç›®å½•..."
    UCI_OUTPUT=$(uci show dhcp.@dnsmasq[0] 2>/dev/null)
    
    if echo "$UCI_OUTPUT" | grep -qE 'cfg[0-9a-f]{6}'; then
        HASH_ID=$(echo "$UCI_OUTPUT" | grep -oE 'cfg[0-9a-f]{6}' | head -1) 
        TARGET_DIR="/tmp/dnsmasq.${HASH_ID}.d"
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] å½“å‰ dnsmasq è§„åˆ™ç›®å½•: $TARGET_DIR"
    elif echo "$UCI_OUTPUT" | grep -qE '@dnsmasq\[[0-9]+\]'; then
        TARGET_DIR="/tmp/dnsmasq.d"
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] å½“å‰dnsmasq è§„åˆ™ç›®å½•: $TARGET_DIR"
    else
        TARGET_DIR=$(find /tmp -maxdepth 1 -type d -name "dnsmasq.*.d" | head -n 1)
        if [ -z "$TARGET_DIR" ]; then
            LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] é”™è¯¯ï¼šæœªæ‰¾åˆ°æœ‰æ•ˆçš„ dnsmasq è§„åˆ™ç›®å½•ï¼Œè„šæœ¬å·²åœæ­¢ï¼"
            exit 1
        fi
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æ£€æµ‹å¤±è´¥ï¼Œä½¿ç”¨å·²å­˜åœ¨çš„ dnsmasq è§„åˆ™ç›®å½•: $TARGET_DIR"
    fi
    
    if [ ! -d "$TARGET_DIR" ]; then
        mkdir -p "$TARGET_DIR"
    fi

    LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æ¸…é™¤å·²æœ‰è§„åˆ™â€¦"
    rm -f "$TARGET_DIR"/*ad*.conf 
    sed -i '/# AWAvenue-Ads-Rule Start/,/# AWAvenue-Ads-Rule End/d' /etc/hosts
    sed -i '/# GitHub520 Host Start/,/# GitHub520 Host End/d' /etc/hosts

    LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æ‹‰å–æœ€æ–°çš„ adblockfilters å¹¿å‘Šè¿‡æ»¤è§„åˆ™ï¼Œè§„åˆ™ä½“ç§¯è¾ƒå¤§ï¼Œè¯·è€å¿ƒç­‰å€™â€¦"
    curl -sS -L -4 --retry 5 --retry-delay 1 "https://testingcf.jsdelivr.net/gh/217heidai/adblockfilters@refs/heads/main/rules/adblockdnsmasq.txt" -o "$TARGET_DIR/adblockfilters-for-dnsmasq.conf" >/dev/null 2>/tmp/adblockfilters-curl.log
    CURL_EXIT=$?

    if [ $CURL_EXIT -eq 0 ]; then
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] adblockfilters è§„åˆ™æ‹‰å–æˆåŠŸï¼ä¿å­˜è·¯å¾„ï¼š${TARGET_DIR}/adblockfilters-for-dnsmasq.conf"
    else
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] adblockfilters è§„åˆ™æ‹‰å–å¤±è´¥ (é”™è¯¯ç :$CURL_EXIT)ï¼ŒæŸ¥çœ‹ /tmp/adblockfilters-curl.log è·å–è¯¦ç»†ä¿¡æ¯ã€‚"
        echo "CURL Exit Code: $CURL_EXIT" >> /tmp/adblockfilters-curl.log
    fi

    LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æ‹‰å–æœ€æ–°çš„ GitHub520 åŠ é€Ÿè§„åˆ™â€¦"
    curl -sS -L -4 --retry 5 --retry-delay 1 "https://raw.hellogithub.com/hosts" >> /etc/hosts >/dev/null 2>/tmp/github520-curl.log
    CURL_EXIT_GH=$?

    if [ $CURL_EXIT_GH -eq 0 ]; then
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] GitHub520 åŠ é€Ÿè§„åˆ™æ‹‰å–æˆåŠŸï¼å·²è¿½åŠ åˆ° /etc/hosts æ–‡ä»¶ä¸­ã€‚"
    else
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] GitHub520 åŠ é€Ÿè§„åˆ™æ‹‰å–å¤±è´¥ (é”™è¯¯ç :$CURL_EXIT_GH)ï¼ŒæŸ¥çœ‹ /tmp/github520-curl.log è·å–è¯¦ç»†ä¿¡æ¯ã€‚"
        echo "CURL Exit Code: $CURL_EXIT_GH" >> /tmp/github520-curl.log
    fi

    sed -i '/^$/d' /etc/hosts
    sed -i '/!/d' /etc/hosts

    LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] é‡æ–°åŠ è½½ dnsmasq æœåŠ¡ä»¥åº”ç”¨è§„åˆ™â€¦"
    /etc/init.d/dnsmasq stop
    /etc/init.d/dnsmasq start
    LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] è„šæœ¬è¿è¡Œå®Œæ¯•ï¼"

) &
# ==============å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬ç»“æŸ==============
```

</details>

<details>
<summary><strong>é€‰é¡¹ 3ï¼šadblockfilters-modified + GitHub520 (é«˜æ€§èƒ½è®¾å¤‡ä¸“ç”¨)</strong></summary>

```bash
# ==============ä»¥ä¸‹æ˜¯å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬=================
(
    MAX_WAIT_TIME=30
    WAIT_INTERVAL=2
    elapsed_time=0

    if /etc/init.d/openclash status | grep -q "Syntax:"; then
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æ­£åœ¨æ£€æµ‹ OpenClash è¿è¡ŒçŠ¶æ€..."
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] ç­‰å¾… 10 ç§’ä»¥ç¡®ä¿ OpenClash å·²å¯åŠ¨..."
        sleep 10
    else
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æ­£åœ¨æ£€æµ‹ OpenClash è¿è¡ŒçŠ¶æ€..."
        while ! /etc/init.d/openclash status | grep -q "running"; do
            if [ $elapsed_time -ge $MAX_WAIT_TIME ]; then
                LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æœªèƒ½åœ¨ 30 ç§’å†…æ£€æµ‹åˆ° OpenClash è¿è¡ŒçŠ¶æ€ï¼Œè„šæœ¬å·²åœæ­¢è¿è¡Œ..."
                exit 1
            fi
            sleep $WAIT_INTERVAL
            elapsed_time=$((elapsed_time + WAIT_INTERVAL))
        done
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æ£€æµ‹åˆ° OpenClash æ­£åœ¨è¿è¡Œï¼Œ10 ç§’åå¼€å§‹æ‹‰å–è§„åˆ™..."
        sleep 10
    fi

    LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] å¼€å§‹æ£€æµ‹ dnsmasq è§„åˆ™ç›®å½•..."
    UCI_OUTPUT=$(uci show dhcp.@dnsmasq[0] 2>/dev/null)
    
    if echo "$UCI_OUTPUT" | grep -qE 'cfg[0-9a-f]{6}'; then
        HASH_ID=$(echo "$UCI_OUTPUT" | grep -oE 'cfg[0-9a-f]{6}' | head -1)  # æ·»åŠ  head -1 ç¡®ä¿åªè·å–ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹
        TARGET_DIR="/tmp/dnsmasq.${HASH_ID}.d"
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] å½“å‰ dnsmasq è§„åˆ™ç›®å½•: $TARGET_DIR"
    elif echo "$UCI_OUTPUT" | grep -qE '@dnsmasq\[[0-9]+\]'; then
        TARGET_DIR="/tmp/dnsmasq.d"
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] å½“å‰dnsmasq è§„åˆ™ç›®å½•: $TARGET_DIR"
    else
        TARGET_DIR=$(find /tmp -maxdepth 1 -type d -name "dnsmasq.*.d" | head -n 1)
        if [ -z "$TARGET_DIR" ]; then
            LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] é”™è¯¯ï¼šæœªæ‰¾åˆ°æœ‰æ•ˆçš„ dnsmasq è§„åˆ™ç›®å½•ï¼Œè„šæœ¬å·²åœæ­¢ï¼"
            exit 1
        fi
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æ£€æµ‹å¤±è´¥ï¼Œä½¿ç”¨å·²å­˜åœ¨çš„ dnsmasq è§„åˆ™ç›®å½•: $TARGET_DIR"
    fi
    
    if [ ! -d "$TARGET_DIR" ]; then
        mkdir -p "$TARGET_DIR"
    fi

    LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æ¸…é™¤å·²æœ‰è§„åˆ™â€¦"
    rm -f "$TARGET_DIR"/*ad*.conf
    sed -i '/# AWAvenue-Ads-Rule Start/,/# AWAvenue-Ads-Rule End/d' /etc/hosts
    sed -i '/# GitHub520 Host Start/,/# GitHub520 Host End/d' /etc/hosts

    LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æ‹‰å–æœ€æ–°çš„ adblockfilters-modified å¹¿å‘Šè¿‡æ»¤è§„åˆ™ï¼Œè§„åˆ™ä½“ç§¯è¾ƒå¤§ï¼Œè¯·è€å¿ƒç­‰å€™â€¦"
    curl -sS -4 -L --retry 5 --retry-delay 1 "https://testingcf.jsdelivr.net/gh/Aethersailor/adblockfilters-modified@refs/heads/main/rules/adblockdnsmasq.txt" -o "$TARGET_DIR/adblockfilters-modified-for-dnsmasq.conf" >/dev/null 2>/tmp/adblockfilters-modified-curl.log
    CURL_EXIT=$?

    if [ $CURL_EXIT -eq 0 ]; then
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] adblockfilters-modified è§„åˆ™æ‹‰å–æˆåŠŸï¼ä¿å­˜è·¯å¾„ï¼š${TARGET_DIR}/adblockfilters-modified-for-dnsmasq.conf"
    else
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] adblockfilters-modified è§„åˆ™æ‹‰å–å¤±è´¥ (é”™è¯¯ç :$CURL_EXIT)ï¼ŒæŸ¥çœ‹ /tmp/adblockfilters-modified-curl.log è·å–è¯¦ç»†ä¿¡æ¯ã€‚"
        echo "CURL Exit Code: $CURL_EXIT" >> /tmp/adblockfilters-modified-curl.log
    fi

    LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æ‹‰å–æœ€æ–°çš„ GitHub520 åŠ é€Ÿè§„åˆ™â€¦"
    curl -sSL -4 --retry 5 --retry-delay 1 "https://raw.hellogithub.com/hosts" >> /etc/hosts 2> /tmp/github520-curl.log
    CURL_EXIT_GH=$?

    if [ $CURL_EXIT_GH -eq 0 ]; then
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] GitHub520 åŠ é€Ÿè§„åˆ™æ‹‰å–æˆåŠŸï¼å·²è¿½åŠ åˆ° /etc/hosts æ–‡ä»¶ä¸­ã€‚"
    else
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] GitHub520 åŠ é€Ÿè§„åˆ™æ‹‰å–å¤±è´¥ (é”™è¯¯ç :$CURL_EXIT_GH)ï¼ŒæŸ¥çœ‹ /tmp/github520-curl.log è·å–è¯¦ç»†ä¿¡æ¯ã€‚"
        echo "CURL Exit Code: $CURL_EXIT_GH" >> /tmp/github520-curl.log
    fi

    sed -i '/^$/d' /etc/hosts
    sed -i '/!/d' /etc/hosts

    LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] é‡æ–°åŠ è½½ dnsmasq æœåŠ¡ä»¥åº”ç”¨è§„åˆ™â€¦"
    /etc/init.d/dnsmasq stop
    /etc/init.d/dnsmasq start
    LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] è„šæœ¬è¿è¡Œå®Œæ¯•ï¼"

) &
# ==============å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬ç»“æŸ==============
```

</details>

<details>
<summary><strong>é€‰é¡¹ 4ï¼šç§‹é£å¹¿å‘Šè§„åˆ™ + GitHub520 (è½»é‡/å®¶ç”¨)</strong></summary>

```bash
# ==============ä»¥ä¸‹æ˜¯å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬=================
(
    MAX_WAIT_TIME=30
    WAIT_INTERVAL=2
    elapsed_time=0

    if /etc/init.d/openclash status | grep -q "Syntax:"; then
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æ­£åœ¨æ£€æµ‹ OpenClash è¿è¡ŒçŠ¶æ€..."
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] ç­‰å¾… 10 ç§’ä»¥ç¡®ä¿ OpenClash å·²å¯åŠ¨..."
        sleep 10
    else
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æ­£åœ¨æ£€æµ‹ OpenClash è¿è¡ŒçŠ¶æ€..."
        while ! /etc/init.d/openclash status | grep -q "running"; do
            if [ $elapsed_time -ge $MAX_WAIT_TIME ]; then
                LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æœªèƒ½åœ¨ 30 ç§’å†…æ£€æµ‹åˆ° OpenClash è¿è¡ŒçŠ¶æ€ï¼Œè„šæœ¬å·²åœæ­¢è¿è¡Œ..."
                exit 1
            fi
            sleep $WAIT_INTERVAL
            elapsed_time=$((elapsed_time + WAIT_INTERVAL))
        done
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æ£€æµ‹åˆ° OpenClash æ­£åœ¨è¿è¡Œï¼Œ10 ç§’åå¼€å§‹æ‹‰å–è§„åˆ™..."
        sleep 10
    fi

    LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] å¼€å§‹æ£€æµ‹ dnsmasq è§„åˆ™ç›®å½•..."
    UCI_OUTPUT=$(uci show dhcp.@dnsmasq[0] 2>/dev/null)
    
    if echo "$UCI_OUTPUT" | grep -qE 'cfg[0-9a-f]{6}'; then
        HASH_ID=$(echo "$UCI_OUTPUT" | grep -oE 'cfg[0-9a-f]{6}' | head -1) 
        TARGET_DIR="/tmp/dnsmasq.${HASH_ID}.d"
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] å½“å‰ dnsmasq è§„åˆ™ç›®å½•: $TARGET_DIR"
    elif echo "$UCI_OUTPUT" | grep -qE '@dnsmasq\[[0-9]+\]'; then
        TARGET_DIR="/tmp/dnsmasq.d"
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] å½“å‰dnsmasq è§„åˆ™ç›®å½•: $TARGET_DIR"
    else
        TARGET_DIR=$(find /tmp -maxdepth 1 -type d -name "dnsmasq.*.d" | head -n 1)
        if [ -z "$TARGET_DIR" ]; then
            LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] é”™è¯¯ï¼šæœªæ‰¾åˆ°æœ‰æ•ˆçš„ dnsmasq è§„åˆ™ç›®å½•ï¼Œè„šæœ¬å·²åœæ­¢ï¼"
            exit 1
        fi
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æ£€æµ‹å¤±è´¥ï¼Œä½¿ç”¨å·²å­˜åœ¨çš„ dnsmasq è§„åˆ™ç›®å½•: $TARGET_DIR"
    fi
    
    if [ ! -d "$TARGET_DIR" ]; then
        mkdir -p "$TARGET_DIR"
    fi

    LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æ¸…é™¤å·²æœ‰è§„åˆ™â€¦"
    rm -f "$TARGET_DIR"/*ad*.conf 
    sed -i '/# AWAvenue-Ads-Rule Start/,/# AWAvenue-Ads-Rule End/d' /etc/hosts
    sed -i '/# GitHub520 Host Start/,/# GitHub520 Host End/d' /etc/hosts

    LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æ‹‰å–æœ€æ–°çš„ ç§‹é£å¹¿å‘Šè§„åˆ™â€¦"
    curl -sSL -4 --retry 5 --retry-delay 1 https://testingcf.jsdelivr.net/gh/TG-Twilight/AWAvenue-Ads-Rule@main/Filters/AWAvenue-Ads-Rule-hosts.txt | \
    sed '/127.0.0.1 localhost/d; /::1 localhost/d; 1s/^/# AWAvenue-Ads-Rule Start\n/; $s/$/\n# AWAvenue-Ads-Rule End/' >> /etc/hosts

    LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æ¸…é™¤å·²æœ‰çš„ GitHub520 åŠ é€Ÿè§„åˆ™â€¦"
    sed -i '/# GitHub520 Host Start/,/# GitHub520 Host End/d' /etc/hosts

    LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æ‹‰å–æœ€æ–°çš„ GitHub520 åŠ é€Ÿè§„åˆ™â€¦"
    curl -sSL -4 --retry 5 --retry-delay 1 "https://raw.hellogithub.com/hosts" >> /etc/hosts 2> /tmp/github520-curl.log

    if [ $? -eq 0 ]; then
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] GitHub520 åŠ é€Ÿè§„åˆ™æ‹‰å–æˆåŠŸï¼"
    else
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] GitHub520 åŠ é€Ÿè§„åˆ™æ‹‰å–å¤±è´¥ï¼ŒæŸ¥çœ‹ /tmp/github520-curl.log è·å–è¯¦ç»†ä¿¡æ¯ã€‚"
    fi

    sed -i '/^$/d' /etc/hosts
    sed -i '/!/d' /etc/hosts

    LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] é‡æ–°åŠ è½½ dnsmasq æœåŠ¡ä»¥åº”ç”¨è§„åˆ™â€¦"
    /etc/init.d/dnsmasq stop
    /etc/init.d/dnsmasq start
    LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] è„šæœ¬è¿è¡Œå®Œæ¯•ï¼"

) &
# ==============å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬ç»“æŸ==============
```

</details>

<details>
<summary><strong>é€‰é¡¹ 5ï¼šä»…æ·»åŠ  GitHub520 åŠ é€Ÿè§„åˆ™</strong></summary>

```bash
# ==============ä»¥ä¸‹æ˜¯å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬=================
(
    MAX_WAIT_TIME=30
    WAIT_INTERVAL=2
    elapsed_time=0

    if /etc/init.d/openclash status | grep -q "Syntax:"; then
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æ­£åœ¨æ£€æµ‹ OpenClash è¿è¡ŒçŠ¶æ€..."
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] ç­‰å¾… 10 ç§’ä»¥ç¡®ä¿ OpenClash å·²å¯åŠ¨..."
        sleep 10
    else
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æ­£åœ¨æ£€æµ‹ OpenClash è¿è¡ŒçŠ¶æ€..."
        while ! /etc/init.d/openclash status | grep -q "running"; do
            if [ $elapsed_time -ge $MAX_WAIT_TIME ]; then
                LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æœªèƒ½åœ¨ 30 ç§’å†…æ£€æµ‹åˆ° OpenClash è¿è¡ŒçŠ¶æ€ï¼Œè„šæœ¬å·²åœæ­¢è¿è¡Œ..."
                exit 1
            fi
            sleep $WAIT_INTERVAL
            elapsed_time=$((elapsed_time + WAIT_INTERVAL))
        done
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æ£€æµ‹åˆ° OpenClash æ­£åœ¨è¿è¡Œï¼Œ10 ç§’åå¼€å§‹æ‹‰å–è§„åˆ™..."
        sleep 10
    fi

    LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] å¼€å§‹æ£€æµ‹ dnsmasq è§„åˆ™ç›®å½•..."
    # é€šè¿‡ uci å‘½ä»¤è·å–é…ç½®æ ‡è¯†ç¬¦
    UCI_OUTPUT=$(uci show dhcp.@dnsmasq[0] 2>/dev/null)
    
    if echo "$UCI_OUTPUT" | grep -qE 'cfg[0-9a-f]{6}'; then
        HASH_ID=$(echo "$UCI_OUTPUT" | grep -oE 'cfg[0-9a-f]{6}' | head -1) 
        TARGET_DIR="/tmp/dnsmasq.${HASH_ID}.d"
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] å½“å‰ dnsmasq è§„åˆ™ç›®å½•: $TARGET_DIR"
    elif echo "$UCI_OUTPUT" | grep -qE '@dnsmasq\[[0-9]+\]'; then
        TARGET_DIR="/tmp/dnsmasq.d"
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] å½“å‰dnsmasq è§„åˆ™ç›®å½•: $TARGET_DIR"
    else
        TARGET_DIR=$(find /tmp -maxdepth 1 -type d -name "dnsmasq.*.d" | head -n 1)
        if [ -z "$TARGET_DIR" ]; then
            LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] é”™è¯¯ï¼šæœªæ‰¾åˆ°æœ‰æ•ˆçš„ dnsmasq è§„åˆ™ç›®å½•ï¼Œè„šæœ¬å·²åœæ­¢ï¼"
            exit 1
        fi
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æ£€æµ‹å¤±è´¥ï¼Œä½¿ç”¨å·²å­˜åœ¨çš„ dnsmasq è§„åˆ™ç›®å½•: $TARGET_DIR"
    fi
    
    if [ ! -d "$TARGET_DIR" ]; then
        mkdir -p "$TARGET_DIR"
    fi

    LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æ¸…é™¤å·²æœ‰è§„åˆ™â€¦"
    rm -f "$TARGET_DIR"/*ad*.conf 
    sed -i '/# AWAvenue-Ads-Rule Start/,/# AWAvenue-Ads-Rule End/d' /etc/hosts
    sed -i '/# GitHub520 Host Start/,/# GitHub520 Host End/d' /etc/hosts

    LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] æ‹‰å–æœ€æ–°çš„ GitHub520 åŠ é€Ÿè§„åˆ™â€¦"
    curl -sSL -4 --retry 5 --retry-delay 1 "https://raw.hellogithub.com/hosts" >> /etc/hosts 2> /tmp/github520-curl.log
    CURL_EXIT_GH=$?

    if [ $CURL_EXIT_GH -eq 0 ]; then
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] GitHub520 åŠ é€Ÿè§„åˆ™æ‹‰å–æˆåŠŸï¼å·²è¿½åŠ åˆ° /etc/hosts æ–‡ä»¶ä¸­ã€‚"
    else
        LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] GitHub520 åŠ é€Ÿè§„åˆ™æ‹‰å–å¤±è´¥ (é”™è¯¯ç :$CURL_EXIT_GH)ï¼ŒæŸ¥çœ‹ /tmp/github520-curl.log è·å–è¯¦ç»†ä¿¡æ¯ã€‚"
        echo "CURL Exit Code: $CURL_EXIT_GH" >> /tmp/github520-curl.log
    fi

    sed -i '/^$/d' /etc/hosts
    sed -i '/!/d' /etc/hosts

    LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] é‡æ–°åŠ è½½ dnsmasq æœåŠ¡ä»¥åº”ç”¨è§„åˆ™â€¦"
    /etc/init.d/dnsmasq stop
    /etc/init.d/dnsmasq start
    LOG_OUT "[å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬] è„šæœ¬è¿è¡Œå®Œæ¯•ï¼"

) &
# ==============å¹¿å‘Šè¿‡æ»¤è§„åˆ™æ‹‰å–è„šæœ¬ç»“æŸ==============
```

</details>

---

## ğŸ—‘ï¸ 5. å¦‚ä½•è¿˜åŸ

è‹¥åŠŸèƒ½å¼‚å¸¸æˆ–ä¸å†éœ€è¦ï¼Œè¯·è¿›å…¥ OpenClash å¼€å‘è€…é€‰é¡¹ï¼Œ**åˆ é™¤ä¸Šè¿°æ·»åŠ ä»£ç **ï¼Œä¿ç•™é»˜è®¤å†…å®¹å³å¯ã€‚

é»˜è®¤ä»£ç ç¤ºä¾‹ï¼ˆä»…ä¾›å‚è€ƒï¼‰ï¼š

```bash
#!/bin/sh
. /usr/share/openclash/log.sh
. /lib/functions.sh

# This script is called by /etc/init.d/openclash
# Add your custom firewall rules here, they will be added after the end of the OpenClash iptables rules

LOG_OUT "Tip: Start Add Custom Firewall Rules..."

exit 0
```
