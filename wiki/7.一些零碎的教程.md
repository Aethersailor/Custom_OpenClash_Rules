想到什么写什么，一些适合新手小白的内容

***

# 1. 订阅转换相关

## 1.1. ImmortalWrt 下搭建订阅转换后端服务  
有些人可能会担心使用公共订阅转换服务会泄露自己的订阅链接，从而选择自建订阅转换服务。  

在 ImmortalWrt 固件的软件源中，已经包含了 subconverter 软件包，只需简单几部操作就可以搭建属于自己的本地订阅转换后端服务。  

如果你的固件软件源中同样有 subconverter 软件包，可以参考此操作。

具体操作步骤： 
```
1. 点击“更新列表”

2. 在过滤器中输入 subconverter

3. 点击 subconverter 软件包后的“安装”，安装对应的软件包  
```

![](../doc/subconverter/subconverter.png)  

没有特殊需求的话，使用 subconverter 的默认配置即可，默认配置已经关闭了缓存功能。也不需要去修改安全相关的参数，毕竟这个订阅转换后端服务只有你自己的内网可用。  

然后在 `OpenClash > 配置订阅`中，填写自定义订阅转换服务地址：  
```
http://127.0.0.1:25500/sub
```

![](../doc/subconverter/subconverter-url.png)

由于 OpenClash 中自带的订阅转换模板地址均为 GitHub 直链，在国内大部分地区无法直接访问，所以如果你的自建后端是使用的国内网络，务必使用模板的加速地址

模板链接建议使用 jsDeliver 的加速地址，连通性比较好，或者其他加速 CDN 地址也行，反正别用 GitHub 原始地址就行了。

保存并应用，即可开始使用自建的订阅转换后端服务进行订阅。  

**注意：本地网络搭建的自建后端，有可能无法直连访问 GitHub，也就无法拉取所有 GitHub 直链的文件（包括但不限于模板、规则等），请自行解决 GitHub 的访问问题，否则后端会使用默认的内置模板进行转换，无法达到本项目所要实现的效果。**

## 1.2. 自建订阅转换后端服务导入本地模板和规则  

以 ImmortalWrt 下搭建的 subconverter 为例，其配置文件所在目录为 `/etc/subconverter `  

将你自己维护的订阅转换模板 .ini 文件，放置在 `/etc/subconverter` 下的 `config` 目录中，比如 `example.ini` 文件，在订阅转换模板地址中使用本地路径进行调用即可，例如 `config/example.ini`

你也可以将模板文件直接放在 /base 下，在`自定义模板的地址`中，无需再填写路径，直接填写文件名 `example.ini` ，subconverter 在转换时即可调用你的本地模板  

![](../doc/subconverter/subconverter-local.png)  

对于规则文件`.list`文件，可以放置在 `/etc/subconverter` 下的 `rules` 目录中，在订阅转换模板地址中使用本地路径进行调用即可，例如 `rules/your_rules.list`。



例如：  
```
ruleset=🎯 全球直连,rules/your_rules.list
```

如此配置后，你的订阅转换完全可以脱离远程文件运行，可以直接在本地进行维护模板和规则，无需再上传 GitHub。  

***

# 2. OpenWrt 相关  

## 2.1. 固件无损扩容  

关于 OpenWrt/ImmortalWrt 的扩容，网上各种教程五花八门。在使用官方发布固件的情况下，借助软件源内的 owut 插件，配合官方的 ASU 服务器，可以非常无脑的实现无损扩容，并且在日后的升级中保留容量，丝滑升级到新版本。  

具体操作步骤：  

1. SSH 连接 OpenWrt/ImmortalWrt  

2. 更新软件源  
根据固件版本使用对应的命令：  
Snapshot：`apk update`  
Release 或更早版本： `opkg update`  
具体使用哪个指令，取决于你的固件使用哪个包管理器。  

3. 安装插件  
安装 owut 与 attendedsysupgrade 插件，根据固件版本使用如下不同命令
Snapshot：`apk add luci-i18n-attendedsysupgrade-zh-cn owut`  
Release: `opkg install luci-i18n-attendedsysupgrade-zh-cn`  

4. 虚拟机硬盘扩容  
物理机直装（包括但不限于 x86/arm 等设备）跳过次步骤。  
如果你使用了 PVE 或者其他的虚拟机，在对固件扩容前，需要提前扩容 OpenWrt 对应的虚拟机硬盘至不小于目标容量的大小，此处不做赘述。  

5. 设置容量参数  
使用 owut 请求固件时，附件的容量参数是临时的。当下次使用 owut 升级系统时，如果不附加参数，ASU 生成的固件会恢复为默认大小。  
因此，我们需要将固件的容量参数写入 attendedsysupgrade 的配置中，这样owut 在请求固件时，会自动调用 attendedsysupgrade 配置文件中设置好的大小参数。  
固件大小上限取决于 ASU 服务器的限制，上限是多少我记不清了，好像是 2GB？。一般 1G 容量已经完全足够重度用户使用了。  
使用如下命令：
```
uci set attendedsysupgrade.owut=owut
# 修改数字为你指定的固件容量大小，单位 MB
uci set attendedsysupgrade.owut.rootfs_size='1024'
uci commit
```

6. 生成扩容后的固件并写入  
此时，你已经可以使用 owut 对固件进行刷写和升级。  
使用 owut 扩容的原理就是生成对应容量大小的固件并刷入，因此不会丢失固件配置和已安装的插件（因为 owut 生成的固件默认包含了你当前已安装的插件）。  
`owut upgrade --force`  
执行命令后，owut 会连接 ASU 服务器请求生成固件，下载并自动刷入、重启。等待系统重启后，新的固件容量就会变为你填写的目标大小。  
并且，此后的历次升级，只需正常使用`owut upgrade --force`命令升级即可，ASU 服务器始终会为我们生成指定容量大小的固件，无需重复扩容，保留所有插件和配置，完全丝滑升级。  

![](../doc/openwrt/pics/space.png) 

